<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POY Shuffler - Full Photo View</title>
    <style>
        /* --- 1. DESIGN SYSTEM --- */
        :root {
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            --glass-panel: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --primary: #6366f1;
            --secondary: #64748b;
            --danger: #ef4444;
            
            /* Default Card Size (Desktop) */
            --card-width: 600px;
            --card-height: 450px;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-gradient);
            color: #f8fafc;
            margin: 0; padding: 20px;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden; /* Prevent horizontal scroll on mobile */
        }

        h1 { 
            margin-bottom: 5px; font-weight: 300; letter-spacing: 4px; text-transform: uppercase; 
            text-align: center; font-size: 1.8rem; /* Smaller font on mobile */
        }
        p.subtitle { 
            color: #94a3b8; font-size: 0.9rem; margin-bottom: 20px; text-align: center; 
        }

        /* --- 2. CONTROLS --- */
        .control-panel {
            background: var(--glass-panel);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            padding: 20px; border-radius: 20px;
            width: 100%; max-width: 850px;
            display: flex; flex-direction: column; gap: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            margin-bottom: 30px;
            z-index: 10;
        }

        .upload-row { 
            display: flex; gap: 15px; flex-wrap: wrap; 
        }

        /* File Inputs */
        .file-box {
            flex: 1 1 100%; /* Full width on mobile by default */
            min-width: 200px; position: relative;
            background: rgba(255,255,255,0.03);
            border: 2px dashed #475569; border-radius: 12px;
            transition: 0.3s;
            min-height: 80px; /* Ensure touch target size */
        }
        .file-box:hover { border-color: var(--primary); background: rgba(99, 102, 241, 0.1); }
        .file-box.has-file { border-color: #4ade80; background: rgba(74, 222, 128, 0.1); }

        input[type="file"] {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0; opacity: 0; cursor: pointer; z-index: 2;
        }

        .label-text {
            padding: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; pointer-events: none; height: 100%;
        }
        .label-text strong { display: block; margin-bottom: 5px; font-size: 0.95rem; }
        .label-text span { font-size: 0.8rem; color: #94a3b8; }

        /* Buttons Area */
        .action-row {
            display: flex; justify-content: center; gap: 10px;
            padding-top: 15px; border-top: 1px solid var(--glass-border);
            flex-wrap: wrap;
        }

        button {
            padding: 12px 20px; border: none; border-radius: 50px;
            font-weight: 600; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            font-size: 0.9rem;
            flex: 1 1 auto; /* Allow buttons to grow/shrink */
            min-width: 140px; /* Minimum width for tap target */
        }

        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }
        button:hover:not(:disabled) { transform: translateY(-2px); filter: brightness(110%); }

        .btn-spin { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3); }
        
        .btn-clear { 
            background: #334155; color: #e2e8f0; 
            border: 1px solid #475569;
        }
        
        .btn-reset-all { 
            background: transparent; color: var(--danger); 
            border: 1px solid var(--danger); font-size: 0.9rem;
        }
        .btn-reset-all:hover { background: rgba(239, 68, 68, 0.1); }

        /* --- 3. BOARD & CARDS --- */
        .board {
            display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 15px;
            width: 100%; max-width: 1200px; perspective: 1500px;
            min-height: 300px; padding-bottom: 100px;
        }

        .card {
            width: var(--card-width); height: var(--card-height);
            position: relative; transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
            cursor: pointer; border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            background: #000; 
            /* Essential for mobile click handling */
            touch-action: manipulation; 
        }

        .face {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 12px; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.15);
            background-color: #121212; 
        }

        .face img {
            width: 100%; height: 100%;
            object-fit: contain; 
            display: block;
        }

        /* Cover */
        .back {
            background: linear-gradient(135deg, #4338ca, #7c3aed);
            display: flex; align-items: center; justify-content: center;
        }
        .back img { object-fit: contain; width: 100%; height: 100%; }
        
        .pattern { font-size: 1.5rem; color: rgba(255,255,255,0.2); font-weight: 800; letter-spacing: 3px; }

        /* Result Image */
        .front { transform: rotateY(180deg); }

        /* Animations */
        .card.flipped { transform: rotateY(180deg); }
        
        .card.stacked {
            transform: translate(var(--tx), var(--ty)) rotate(var(--rot)) !important;
            z-index: 100;
        }

        .board.shaking .card.stacked { animation: shake 0.3s infinite alternate; }

        @keyframes shake {
            0% { margin-left: 0; } 25% { margin-left: -3px; margin-top: 2px; }
            75% { margin-left: 3px; margin-top: -2px; } 100% { margin-left: 0; }
        }

        /* --- RESPONSIVE BREAKPOINTS --- */
        
        /* Tablet & Small Laptop */
        @media (min-width: 601px) and (max-width: 1024px) {
             :root { 
                --card-width: 400px; 
                --card-height: 300px; 
            }
            .file-box { flex: 1; } /* Side by side on tablet */
        }

        /* Mobile Phones */
        @media (max-width: 600px) {
            :root { 
                /* Significantly reduce card size for mobile */
                --card-width: 85vw; /* Use viewport width relative sizing */
                --card-height: 63.75vw; /* Maintain 4:3 Aspect Ratio (85 * 0.75) */
            }
            
            body { padding: 10px; }
            
            h1 { font-size: 1.5rem; letter-spacing: 2px; }
            
            .control-panel { padding: 15px; }
            
            .action-row { gap: 8px; }
            
            button { 
                padding: 10px 15px; 
                font-size: 0.85rem; 
                width: 100%; /* Full width buttons on small screens usually better for touch */
                flex: 1 1 45%; /* Two buttons per row if space permits */
            }
            
            .board { gap: 10px; padding-bottom: 50px; }
        }
    </style>
</head>
<body>

    <h1>Point of You</h1>
    <p class="subtitle">Full Photo Viewer</p>

    <div class="control-panel">
        <div class="upload-row">
            <div class="file-box" id="boxCover">
                <div class="label-text">
                    <strong>üé® 1. Cover Belakang</strong>
                    <span id="txtCover">Default (Opsional)</span>
                </div>
                <input type="file" id="inCover" accept="image/*">
            </div>

            <div class="file-box" id="boxDeck">
                <div class="label-text">
                    <strong>üé¥ 2. Upload Kartu</strong>
                    <span id="txtDeck">0 Kartu Dimuat</span>
                </div>
                <input type="file" id="inDeck" multiple accept="image/*">
            </div>
        </div>

        <div class="action-row">
            <button class="btn-spin" id="btn3" onclick="play(3)" disabled>Putar 3 Kartu</button>
            <button class="btn-spin" id="btn5" onclick="play(5)" disabled>Putar 5 Kartu</button>
            
            <button class="btn-clear" onclick="clearTable()">üßπ Bersihkan</button>
            <button class="btn-reset-all" onclick="resetAll()">üóëÔ∏è Reset</button>
        </div>
    </div>

    <div class="board" id="board"></div>

    <script>
        // State Variables
        let deck = [];
        let cover = null;

        const ui = {
            inDeck: document.getElementById('inDeck'),
            inCover: document.getElementById('inCover'),
            txtDeck: document.getElementById('txtDeck'),
            txtCover: document.getElementById('txtCover'),
            boxDeck: document.getElementById('boxDeck'),
            boxCover: document.getElementById('boxCover'),
            btn3: document.getElementById('btn3'),
            btn5: document.getElementById('btn5'),
            board: document.getElementById('board')
        };

        // --- 1. UPLOAD LOGIC ---
        
        ui.inCover.addEventListener('change', (e) => {
            if(e.target.files[0]) {
                cover = URL.createObjectURL(e.target.files[0]);
                ui.txtCover.innerText = "Cover Custom Terpasang";
                ui.boxCover.classList.add('has-file');
            }
        });

        ui.inDeck.addEventListener('change', (e) => {
            if(e.target.files.length > 0) {
                deck = Array.from(e.target.files).map(f => URL.createObjectURL(f));
                ui.txtDeck.innerText = `${deck.length} Kartu Siap`;
                ui.boxDeck.classList.add('has-file');
                updateButtons();
            }
        });

        function updateButtons() {
            ui.btn3.disabled = deck.length < 3;
            ui.btn5.disabled = deck.length < 5;
        }

        // --- 2. GAME LOGIC ---

        async function play(count) {
            if(deck.length < count) return;
            
            ui.btn3.disabled = true; ui.btn5.disabled = true;
            ui.board.innerHTML = '';

            // Generate Kartu
            const cards = [];
            for(let i=0; i<count; i++) {
                const c = createCardEl();
                ui.board.appendChild(c);
                cards.push(c);
            }
            
            await wait(50);

            // Hitung Center untuk numpuk
            // Re-calculate rects inside play for responsiveness
            const boardRect = ui.board.getBoundingClientRect();
            const cx = boardRect.width / 2;
            const cy = boardRect.height / 2;

            cards.forEach(c => {
                const r = c.getBoundingClientRect();
                // Relative positioning calculation fix for responsiveness
                const tx = cx - (r.left - boardRect.left + r.width/2);
                const ty = cy - (r.top - boardRect.top + r.height/2);
                
                // Slightly reduced rotation for mobile aesthetic
                const rot = (Math.random() * 8 - 4) + 'deg'; 

                c.style.setProperty('--tx', `${tx}px`);
                c.style.setProperty('--ty', `${ty}px`);
                c.style.setProperty('--rot', rot);
                c.classList.add('stacked');
            });

            // Animasi Kocok
            ui.board.classList.add('shaking');
            await wait(1500);
            ui.board.classList.remove('shaking');

            // Pilih Kartu Acak
            const shuffled = [...deck].sort(() => Math.random() - 0.5);
            const selected = shuffled.slice(0, count);

            // Sebar dan Isi Gambar
            cards.forEach((c, i) => {
                c.querySelector('.front').innerHTML = `<img src="${selected[i]}">`;
                c.classList.remove('stacked');
            });

            await wait(600);

            // Buka Kartu Otomatis (Sequential)
            cards.forEach((c, i) => {
                // Add touchstart for faster mobile response
                const flipAction = (e) => {
                    e.preventDefault(); // Prevent double firing on some devices
                    c.classList.toggle('flipped');
                };
                
                c.addEventListener('click', flipAction);
                // Also enable standard click for consistency
                
                setTimeout(() => c.classList.add('flipped'), i * 300);
            });
        }

        function createCardEl() {
            const div = document.createElement('div');
            div.className = 'card';
            const backContent = cover ? `<img src="${cover}">` : `<div class="pattern">POY</div>`;
            div.innerHTML = `
                <div class="face back">${backContent}</div>
                <div class="face front"></div>
            `;
            return div;
        }

        // --- 3. RESET FUNCTIONS ---

        function clearTable() {
            ui.board.innerHTML = ''; 
            updateButtons(); 
        }

        function resetAll() {
            ui.board.innerHTML = '';
            deck = [];
            cover = null;
            
            ui.inDeck.value = '';
            ui.inCover.value = '';
            
            ui.txtDeck.innerText = '0 Kartu Dimuat';
            ui.boxDeck.classList.remove('has-file');
            ui.txtCover.innerText = 'Default (Opsional)';
            ui.boxCover.classList.remove('has-file');
            
            ui.btn3.disabled = true;
            ui.btn5.disabled = true;
        }

        const wait = ms => new Promise(r => setTimeout(r, ms));

    </script>
</body>
</html>
